<?xml version="1.0" encoding="UTF-8"?>
<!-- 
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:cxf="http://cxf.apache.org/blueprint/core"
           xmlns:jaxws="http://cxf.apache.org/blueprint/jaxws"
           xmlns:amq="http://activemq.apache.org/schema/core"
           xsi:schemaLocation="
             http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd
             http://camel.apache.org/schema/blueprint/core http://cxf.apache.org/schemas/blueprint/core.xsd 
             http://cxf.apache.org/blueprint/jaxws http://cxf.apache.org/schemas/blueprint/jaxws.xsd
             http://camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd
             http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core.xsd">
-->

<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:jaxws="http://cxf.apache.org/blueprint/jaxws"
           xmlns:cxf="http://cxf.apache.org/blueprint/core"
           xmlns:amq="http://activemq.apache.org/schema/core"
           xsi:schemaLocation="
      http://cxf.apache.org/blueprint/core http://cxf.apache.org/schemas/blueprint/core.xsd
      http://cxf.apache.org/blueprint/jaxws http://cxf.apache.org/schemas/blueprint/jaxws.xsd
      http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core.xsd">
             
  <bean id="input" class="org.apache.camel.example.reportincident.ReportFactory" />


  <!--   implicitly used by CXF JMS transport  --> 
  <!-- <bean id="activeMQ" class="org.apache.activemq.camel.component.ActiveMQComponent">
    <property name="configuration" ref="jmsConfig"/>
  </bean> -->
 
  <bean id="ConnectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory">
    <property name="brokerURL" value="tcp://localhost:61616"/>
    <property name="userName" value="admin"/>
    <property name="password" value="admin"/>
  </bean>
  
  <bean id="pooledConnectionFactory" class="org.apache.activemq.pool.PooledConnectionFactory" init-method="start" destroy-method="stop">
    <property name="maxConnections" value="1"/>
    <property name="connectionFactory" ref="ConnectionFactory"/>
  </bean>
  
  <!-- This does not do anything -->
  <bean id="jms" class="org.apache.camel.component.jms.JmsComponent"> 
     <property name="configuration" ref="jmsConfig" />
  </bean>
  <bean id="jmsConfig" class="org.apache.camel.component.jms.JmsConfiguration">
    <property name="connectionFactory" ref="pooledConnectionFactory"/>
    <property name="concurrentConsumers" value="1"/>
    <property name="replyTo" value="TEST.REPORT.RESP" />
    <property name="replyToOverride" value="TEST.REPORT.RRESP" />
  </bean>


  <bean id="jmsConfiguration" class="org.apache.cxf.transport.jms.JMSConfiguration">
    <property name="connectionFactory" ref="pooledConnectionFactory"/>
    <property name="concurrentConsumers" value="1"/>
    <property name="targetDestination" value="TEST.REPORT.REQ" />
    <property name="replyDestination" value="TEST.REPORT.RESP" />
    <property name="replyToDestination" value="TEST.REPORT.RRESP" />
  </bean>
 

  <jaxws:client id="reportService" xmlns:tns="http://reportincident.example.camel.apache.org"
                serviceClass="org.apache.camel.example.reportincident.ReportIncidentEndpoint"
                wsdlLocation="wsdl/report_incident.wsdl"
                serviceName="tns:ReportIncidentEndpointService"
                endpointName="tns:ReportIncidentService"
                address="jms://" >
        <!-- 
        address="jms:queue:TEST.REPORT.REQ?exchangePattern=InOut&amp;messageType=text&amp;dataFormat=MESSAGE&amp;replyTo=TEST.REPORT.RESP"
         -->
        <jaxws:features>
        <bean class="org.apache.cxf.transport.jms.JMSConfigFeature">
        	<property name="jmsConfig" ref="jmsConfiguration" />
        </bean>
        </jaxws:features>
        
  </jaxws:client>
                    
<!-- 
  <bean id="reporter" class="org.apache.camel.example.reportincident.Reporter">
        <property name="reportService" ref="reportService"/>
    </bean>
-->
<!-- 
    <cxf:properties>
       <entry key="dataFormat" value="CXF_MESSAGE"/>
    </cxf:properties>
 -->
 <!-- 
    <cxf:features>
      <bean class="org.apache.cxf.transport.jms.ConnectionFactoryFeature" >
         <constructor-arg ref="pooledConnectionFactory"/>
      </bean>


      <bean class="org.apache.cxf.transport.jms.JMSConfigFeature">
        <property name="jmsConfiguration" ref="jmsConfiguration"/>
      </bean>
    </cxf:features>
     -->
     <!-- 
  </jaxws:client>
 -->
<!--
                   address="jms:queue:TEST.REPORT.REQ?messageType=text&amp;replyToName=TEST.REPORT.RESP"
                   address="jms:queue:TEST.REPORT.REQ?exchangePattern=InOut&amp;messageType=text&amp;replyTo=TEST.REPORT.RESP&amp;replyToOverride=TEST.REPORT.RRESP"
                   address="jms:queue:TEST.REPORT.REQ?exchangePattern=InOut&amp;messageType=text&amp;replyTo=TEST.REPORT.RRESP&amp;disableReplyTo=true"
 -->
 <!-- 
  <cxf:cxfEndpoint id="responseEndpoint"
                   address="jms:queue:TEST.REPORT.RES?exchangePattern=InOnly"
                   serviceClass="org.apache.camel.example.reportincident.ReportIncidentEndpoint"
                   wsdlURL="wsdl/report_incident.wsdl"/>
 -->

  <camelContext xmlns="http://camel.apache.org/schema/blueprint" trace="false">
  <route id="sendIncident" trace="true">
    <from uri="timer://simpleTimer?period=30000"/>
    <bean ref="input" method="createInputReportIncident"/>

<!-- 
    <setHeader headerName="JMSReplyTo">
      <constant>TEST.REPORT.RRESP</constant>
    </setHeader>
 -->
 
    <to uri="bean:reportService"/>
<!--
    <bean ref="myReportEndpoint" method="reportIncident" />
-->
    <log message="The body of the response is: ${body}" loggingLevel="INFO"/>
<!--  
    <pollEnrich uri="cxf:bean:responseEndpoint"  timeout="5000"/>
 -->
 
  </route>
  </camelContext>

</blueprint>
